# -*- makefile -*-

GNULIB = ../gnulib
GNULIB_TOOL = $(GNULIB)/gnulib-tool

all: po/POTFILES.in
	$(GNULIB_TOOL) --import
	autoreconf --install

gettextize:
	touch m4/Makefile.am
	gettextize -f -c --intl --no-changelog

po/POTFILES.in:
	for f in `find src -name \*.[qc] -print | sed 's/\.[qc]$$//'`; do \
		if test $$f = src/version.c; then break; fi;		  \
		if test -e $$f.q; then echo $$f.q; else echo $$f.c; fi	  \
	done | sort | uniq > $@.tmp
	if test ! -e $@ || ! cmp -s $@.tmp $@; then mv $@.tmp $@; fi
	rm -f $@.tmp

PO_FILES = po/ChangeLog po/Makefile po/Makefile.in po/Makefile.in.in	\
po/POTFILES po/POTFILES.in po/Rules-quot po/boldquot.sed		\
po/cat-id-tbl.c po/en@boldquot.header po/en@quot.header			\
po/insert-header.sin po/quot.sed po/remove-potcdate.sin po/stamp-po	\
po/Makevars.template

clean:
	rm -f config.sub config.guess config.rpath
	rm -f ABOUT-NLS
	rm -fr autom4te.cache
	rm -f aclocal.m4
	rm -f missing mkinstalldirs
	rm -f install-sh
	rm -f configure Makefile Makefile.in
	rm -f depcomp
	rm -fr intl gl
	rm -f m4/*.m4
	rm -f $(PO_FILES)

.PHONY: all gettextize potfiles clean
